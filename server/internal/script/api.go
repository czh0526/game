package script\n\nimport (\n\t\"encoding/json\"\n\t\"fmt\"\n\t\"net/http\"\n\t\"strconv\"\n\t\"strings\"\n)\n\n// API 剧本管理API\ntype API struct {\n\tengine *ScriptEngine\n}\n\n// NewAPI 创建新的剧本API\nfunc NewAPI(engine *ScriptEngine) *API {\n\treturn &API{\n\t\tengine: engine,\n\t}\n}\n\n// RegisterRoutes 注册路由\nfunc (api *API) RegisterRoutes(mux *http.ServeMux) {\n\t// 剧本管理\n\tmux.HandleFunc(\"/api/scripts\", api.handleScripts)\n\tmux.HandleFunc(\"/api/scripts/\", api.handleScript)\n\t\n\t// 剧本实例管理\n\tmux.HandleFunc(\"/api/script-instances\", api.handleScriptInstances)\n\tmux.HandleFunc(\"/api/script-instances/\", api.handleScriptInstance)\n\t\n\t// 剧本编辑器\n\tmux.HandleFunc(\"/admin/script-editor\", api.handleScriptEditor)\n}\n\n// handleScripts 处理剧本列表请求\nfunc (api *API) handleScripts(w http.ResponseWriter, r *http.Request) {\n\tswitch r.Method {\n\tcase http.MethodGet:\n\t\tapi.listScripts(w, r)\n\tcase http.MethodPost:\n\t\tapi.createScript(w, r)\n\tdefault:\n\t\thttp.Error(w, \"Method not allowed\", http.StatusMethodNotAllowed)\n\t}\n}\n\n// handleScript 处理单个剧本请求\nfunc (api *API) handleScript(w http.ResponseWriter, r *http.Request) {\n\t// 提取剧本ID\n\tpath := strings.TrimPrefix(r.URL.Path, \"/api/scripts/\")\n\tscriptID := strings.Split(path, \"/\")[0]\n\t\n\tif scriptID == \"\" {\n\t\thttp.Error(w, \"Script ID is required\", http.StatusBadRequest)\n\t\treturn\n\t}\n\t\n\tswitch r.Method {\n\tcase http.MethodGet:\n\t\tapi.getScript(w, r, scriptID)\n\tcase http.MethodPut:\n\t\tapi.updateScript(w, r, scriptID)\n\tcase http.MethodDelete:\n\t\tapi.deleteScript(w, r, scriptID)\n\tdefault:\n\t\thttp.Error(w, \"Method not allowed\", http.StatusMethodNotAllowed)\n\t}\n}\n\n// listScripts 列出所有剧本\nfunc (api *API) listScripts(w http.ResponseWriter, r *http.Request) {\n\tscripts := api.engine.ListScripts()\n\t\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(map[string]interface{}{\n\t\t\"scripts\": scripts,\n\t\t\"total\":   len(scripts),\n\t})\n}\n\n// createScript 创建新剧本\nfunc (api *API) createScript(w http.ResponseWriter, r *http.Request) {\n\tvar script GameScript\n\tif err := json.NewDecoder(r.Body).Decode(&script); err != nil {\n\t\thttp.Error(w, fmt.Sprintf(\"Invalid request body: %v\", err), http.StatusBadRequest)\n\t\treturn\n\t}\n\t\n\t// 验证必需字段\n\tif script.Name == \"\" {\n\t\thttp.Error(w, \"Script name is required\", http.StatusBadRequest)\n\t\treturn\n\t}\n\t\n\tif script.GameID == \"\" {\n\t\tscript.GameID = \"default\"\n\t}\n\t\n\tif script.Status == \"\" {\n\t\tscript.Status = \"draft\"\n\t}\n\t\n\tif err := api.engine.CreateScript(&script); err != nil {\n\t\thttp.Error(w, fmt.Sprintf(\"Failed to create script: %v\", err), http.StatusInternalServerError)\n\t\treturn\n\t}\n\t\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tw.WriteHeader(http.StatusCreated)\n\tjson.NewEncoder(w).Encode(script)\n}\n\n// getScript 获取剧本详情\nfunc (api *API) getScript(w http.ResponseWriter, r *http.Request, scriptID string) {\n\tscript, err := api.engine.GetScript(scriptID)\n\tif err != nil {\n\t\thttp.Error(w, fmt.Sprintf(\"Script not found: %v\", err), http.StatusNotFound)\n\t\treturn\n\t}\n\t\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(script)\n}\n\n// updateScript 更新剧本\nfunc (api *API) updateScript(w http.ResponseWriter, r *http.Request, scriptID string) {\n\tvar script GameScript\n\tif err := json.NewDecoder(r.Body).Decode(&script); err != nil {\n\t\thttp.Error(w, fmt.Sprintf(\"Invalid request body: %v\", err), http.StatusBadRequest)\n\t\treturn\n\t}\n\t\n\tscript.ID = scriptID\n\t\n\tif err := api.engine.UpdateScript(&script); err != nil {\n\t\thttp.Error(w, fmt.Sprintf(\"Failed to update script: %v\", err), http.StatusInternalServerError)\n\t\treturn\n\t}\n\t\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(script)\n}\n\n// deleteScript 删除剧本\nfunc (api *API) deleteScript(w http.ResponseWriter, r *http.Request, scriptID string) {\n\tif err := api.engine.DeleteScript(scriptID); err != nil {\n\t\thttp.Error(w, fmt.Sprintf(\"Failed to delete script: %v\", err), http.StatusInternalServerError)\n\t\treturn\n\t}\n\t\n\tw.WriteHeader(http.StatusNoContent)\n}\n\n// handleScriptInstances 处理剧本实例列表请求\nfunc (api *API) handleScriptInstances(w http.ResponseWriter, r *http.Request) {\n\tswitch r.Method {\n\tcase http.MethodGet:\n\t\tapi.listScriptInstances(w, r)\n\tcase http.MethodPost:\n\t\tapi.startScriptInstance(w, r)\n\tdefault:\n\t\thttp.Error(w, \"Method not allowed\", http.StatusMethodNotAllowed)\n\t}\n}\n\n// handleScriptInstance 处理单个剧本实例请求\nfunc (api *API) handleScriptInstance(w http.ResponseWriter, r *http.Request) {\n\t// 提取实例ID\n\tpath := strings.TrimPrefix(r.URL.Path, \"/api/script-instances/\")\n\tinstanceID := strings.Split(path, \"/\")[0]\n\t\n\tif instanceID == \"\" {\n\t\thttp.Error(w, \"Instance ID is required\", http.StatusBadRequest)\n\t\treturn\n\t}\n\t\n\tswitch r.Method {\n\tcase http.MethodGet:\n\t\tapi.getScriptInstance(w, r, instanceID)\n\tcase http.MethodDelete:\n\t\tapi.stopScriptInstance(w, r, instanceID)\n\tdefault:\n\t\thttp.Error(w, \"Method not allowed\", http.StatusMethodNotAllowed)\n\t}\n}\n\n// listScriptInstances 列出剧本实例\nfunc (api *API) listScriptInstances(w http.ResponseWriter, r *http.Request) {\n\t// 获取查询参数\n\troomID := r.URL.Query().Get(\"roomId\")\n\tstatus := r.URL.Query().Get(\"status\")\n\t\n\t// 这里需要实现实例过滤逻辑\n\tinstances := make([]*ScriptInstance, 0)\n\t\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(map[string]interface{}{\n\t\t\"instances\": instances,\n\t\t\"total\":     len(instances),\n\t})\n}\n\n// startScriptInstance 启动剧本实例\nfunc (api *API) startScriptInstance(w http.ResponseWriter, r *http.Request) {\n\tvar req struct {\n\t\tScriptID string   `json:\"scriptId\"`\n\t\tRoomID   string   `json:\"roomId\"`\n\t\tPlayers  []string `json:\"players\"`\n\t}\n\t\n\tif err := json.NewDecoder(r.Body).Decode(&req); err != nil {\n\t\thttp.Error(w, fmt.Sprintf(\"Invalid request body: %v\", err), http.StatusBadRequest)\n\t\treturn\n\t}\n\t\n\tif req.ScriptID == \"\" || req.RoomID == \"\" {\n\t\thttp.Error(w, \"scriptId and roomId are required\", http.StatusBadRequest)\n\t\treturn\n\t}\n\t\n\tinstance, err := api.engine.StartScript(req.ScriptID, req.RoomID, req.Players)\n\tif err != nil {\n\t\thttp.Error(w, fmt.Sprintf(\"Failed to start script: %v\", err), http.StatusInternalServerError)\n\t\treturn\n\t}\n\t\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tw.WriteHeader(http.StatusCreated)\n\tjson.NewEncoder(w).Encode(instance)\n}\n\n// getScriptInstance 获取剧本实例详情\nfunc (api *API) getScriptInstance(w http.ResponseWriter, r *http.Request, instanceID string) {\n\t// 这里需要实现获取实例的逻辑\n\thttp.Error(w, \"Not implemented\", http.StatusNotImplemented)\n}\n\n// stopScriptInstance 停止剧本实例\nfunc (api *API) stopScriptInstance(w http.ResponseWriter, r *http.Request, instanceID string) {\n\tif err := api.engine.StopScript(instanceID); err != nil {\n\t\thttp.Error(w, fmt.Sprintf(\"Failed to stop script: %v\", err), http.StatusInternalServerError)\n\t\treturn\n\t}\n\t\n\tw.WriteHeader(http.StatusNoContent)\n}\n\n// handleScriptEditor 处理剧本编辑器页面\nfunc (api *API) handleScriptEditor(w http.ResponseWriter, r *http.Request) {\n\tif r.Method != http.MethodGet {\n\t\thttp.Error(w, \"Method not allowed\", http.StatusMethodNotAllowed)\n\t\treturn\n\t}\n\t\n\t// 返回剧本编辑器HTML页面\n\tw.Header().Set(\"Content-Type\", \"text/html\")\n\tw.Write([]byte(scriptEditorHTML))\n}\n\n// scriptEditorHTML 剧本编辑器HTML页面\nconst scriptEditorHTML = `\n<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>剧本编辑器 - Aries Game System</title>\n    <style>\n        body {\n            margin: 0;\n            padding: 0;\n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n            background: #1a1a1a;\n            color: #ffffff;\n        }\n        \n        .header {\n            background: #2d2d2d;\n            padding: 15px 20px;\n            border-bottom: 1px solid #444;\n        }\n        \n        .header h1 {\n            margin: 0;\n            color: #00ff88;\n        }\n        \n        .container {\n            display: flex;\n            height: calc(100vh - 70px);\n        }\n        \n        .sidebar {\n            width: 300px;\n            background: #2d2d2d;\n            border-right: 1px solid #444;\n            overflow-y: auto;\n        }\n        \n        .main-content {\n            flex: 1;\n            padding: 20px;\n            overflow-y: auto;\n        }\n        \n        .script-list {\n            padding: 15px;\n        }\n        \n        .script-item {\n            background: #3d3d3d;\n            margin: 10px 0;\n            padding: 15px;\n            border-radius: 5px;\n            cursor: pointer;\n            border: 1px solid transparent;\n        }\n        \n        .script-item:hover {\n            border-color: #00ff88;\n        }\n        \n        .script-item.active {\n            background: #4d4d4d;\n            border-color: #00ff88;\n        }\n        \n        .script-name {\n            font-weight: bold;\n            margin-bottom: 5px;\n        }\n        \n        .script-desc {\n            font-size: 12px;\n            color: #ccc;\n        }\n        \n        .script-status {\n            display: inline-block;\n            padding: 2px 8px;\n            border-radius: 3px;\n            font-size: 10px;\n            margin-top: 5px;\n        }\n        \n        .status-active { background: #4CAF50; }\n        .status-draft { background: #ff9800; }\n        .status-inactive { background: #f44336; }\n        \n        .btn {\n            background: #00ff88;\n            color: #000;\n            border: none;\n            padding: 10px 20px;\n            border-radius: 5px;\n            cursor: pointer;\n            font-weight: bold;\n            margin: 5px;\n        }\n        \n        .btn:hover {\n            background: #00cc6a;\n        }\n        \n        .btn-secondary {\n            background: #666;\n            color: #fff;\n        }\n        \n        .btn-danger {\n            background: #f44336;\n            color: #fff;\n        }\n        \n        .form-group {\n            margin: 15px 0;\n        }\n        \n        .form-group label {\n            display: block;\n            margin-bottom: 5px;\n            font-weight: bold;\n        }\n        \n        .form-group input,\n        .form-group textarea,\n        .form-group select {\n            width: 100%;\n            padding: 10px;\n            background: #3d3d3d;\n            border: 1px solid #555;\n            border-radius: 3px;\n            color: #fff;\n            box-sizing: border-box;\n        }\n        \n        .form-group textarea {\n            height: 100px;\n            resize: vertical;\n        }\n        \n        .tabs {\n            display: flex;\n            border-bottom: 1px solid #444;\n            margin-bottom: 20px;\n        }\n        \n        .tab {\n            padding: 10px 20px;\n            cursor: pointer;\n            border-bottom: 2px solid transparent;\n        }\n        \n        .tab.active {\n            border-bottom-color: #00ff88;\n            color: #00ff88;\n        }\n        \n        .tab-content {\n            display: none;\n        }\n        \n        .tab-content.active {\n            display: block;\n        }\n        \n        .json-editor {\n            background: #2d2d2d;\n            border: 1px solid #555;\n            border-radius: 5px;\n            padding: 15px;\n            font-family: 'Courier New', monospace;\n            font-size: 14px;\n            min-height: 400px;\n        }\n        \n        .toolbar {\n            margin-bottom: 20px;\n        }\n        \n        .status-bar {\n            position: fixed;\n            bottom: 0;\n            left: 0;\n            right: 0;\n            background: #2d2d2d;\n            padding: 10px 20px;\n            border-top: 1px solid #444;\n            font-size: 12px;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"header\">\n        <h1>剧本编辑器</h1>\n    </div>\n    \n    <div class=\"container\">\n        <div class=\"sidebar\">\n            <div class=\"script-list\">\n                <button class=\"btn\" onclick=\"createNewScript()\">新建剧本</button>\n                <div id=\"scriptList\"></div>\n            </div>\n        </div>\n        \n        <div class=\"main-content\">\n            <div id=\"editorContent\">\n                <div class=\"toolbar\">\n                    <button class=\"btn\" onclick=\"saveScript()\" id=\"saveBtn\" disabled>保存</button>\n                    <button class=\"btn btn-secondary\" onclick=\"validateScript()\">验证</button>\n                    <button class=\"btn btn-secondary\" onclick=\"previewScript()\">预览</button>\n                    <button class=\"btn btn-danger\" onclick=\"deleteScript()\" id=\"deleteBtn\" disabled>删除</button>\n                </div>\n                \n                <div class=\"tabs\">\n                    <div class=\"tab active\" onclick=\"switchTab('basic')\">基本信息</div>\n                    <div class=\"tab\" onclick=\"switchTab('scenes')\">场景</div>\n                    <div class=\"tab\" onclick=\"switchTab('tasks')\">任务</div>\n                    <div class=\"tab\" onclick=\"switchTab('rules')\">规则</div>\n                    <div class=\"tab\" onclick=\"switchTab('json')\">JSON编辑</div>\n                </div>\n                \n                <div id=\"basicTab\" class=\"tab-content active\">\n                    <div class=\"form-group\">\n                        <label>剧本名称</label>\n                        <input type=\"text\" id=\"scriptName\" placeholder=\"输入剧本名称\">\n                    </div>\n                    <div class=\"form-group\">\n                        <label>描述</label>\n                        <textarea id=\"scriptDescription\" placeholder=\"输入剧本描述\"></textarea>\n                    </div>\n                    <div class=\"form-group\">\n                        <label>版本</label>\n                        <input type=\"text\" id=\"scriptVersion\" placeholder=\"1.0.0\">\n                    </div>\n                    <div class=\"form-group\">\n                        <label>作者</label>\n                        <input type=\"text\" id=\"scriptAuthor\" placeholder=\"作者名称\">\n                    </div>\n                    <div class=\"form-group\">\n                        <label>游戏ID</label>\n                        <input type=\"text\" id=\"scriptGameId\" placeholder=\"default\">\n                    </div>\n                    <div class=\"form-group\">\n                        <label>状态</label>\n                        <select id=\"scriptStatus\">\n                            <option value=\"draft\">草稿</option>\n                            <option value=\"active\">活跃</option>\n                            <option value=\"inactive\">非活跃</option>\n                        </select>\n                    </div>\n                </div>\n                \n                <div id=\"scenesTab\" class=\"tab-content\">\n                    <h3>场景管理</h3>\n                    <button class=\"btn\" onclick=\"addScene()\">添加场景</button>\n                    <div id=\"scenesList\"></div>\n                </div>\n                \n                <div id=\"tasksTab\" class=\"tab-content\">\n                    <h3>任务管理</h3>\n                    <button class=\"btn\" onclick=\"addTask()\">添加任务</button>\n                    <div id=\"tasksList\"></div>\n                </div>\n                \n                <div id=\"rulesTab\" class=\"tab-content\">\n                    <h3>规则管理</h3>\n                    <button class=\"btn\" onclick=\"addRule()\">添加规则</button>\n                    <div id=\"rulesList\"></div>\n                </div>\n                \n                <div id=\"jsonTab\" class=\"tab-content\">\n                    <h3>JSON编辑器</h3>\n                    <textarea id=\"jsonEditor\" class=\"json-editor\"></textarea>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <div class=\"status-bar\">\n        <span id=\"statusText\">就绪</span>\n    </div>\n    \n    <script>\n        let currentScript = null;\n        let scripts = [];\n        \n        // 初始化\n        document.addEventListener('DOMContentLoaded', function() {\n            loadScripts();\n        });\n        \n        // 加载剧本列表\n        async function loadScripts() {\n            try {\n                const response = await fetch('/api/scripts');\n                const data = await response.json();\n                scripts = data.scripts || [];\n                renderScriptList();\n            } catch (error) {\n                console.error('Failed to load scripts:', error);\n                setStatus('加载剧本失败: ' + error.message, 'error');\n            }\n        }\n        \n        // 渲染剧本列表\n        function renderScriptList() {\n            const listElement = document.getElementById('scriptList');\n            listElement.innerHTML = '';\n            \n            scripts.forEach(script => {\n                const item = document.createElement('div');\n                item.className = 'script-item';\n                item.onclick = () => selectScript(script);\n                \n                item.innerHTML = \\`\n                    <div class=\"script-name\">\\${script.name}</div>\n                    <div class=\"script-desc\">\\${script.description || '无描述'}</div>\n                    <span class=\"script-status status-\\${script.status}\">\\${getStatusText(script.status)}</span>\n                \\`;\n                \n                listElement.appendChild(item);\n            });\n        }\n        \n        // 选择剧本\n        function selectScript(script) {\n            currentScript = script;\n            \n            // 更新UI状态\n            document.querySelectorAll('.script-item').forEach(item => {\n                item.classList.remove('active');\n            });\n            event.currentTarget.classList.add('active');\n            \n            // 启用按钮\n            document.getElementById('saveBtn').disabled = false;\n            document.getElementById('deleteBtn').disabled = false;\n            \n            // 填充表单\n            fillScriptForm(script);\n            \n            setStatus(\\`已选择剧本: \\${script.name}\\`);\n        }\n        \n        // 填充剧本表单\n        function fillScriptForm(script) {\n            document.getElementById('scriptName').value = script.name || '';\n            document.getElementById('scriptDescription').value = script.description || '';\n            document.getElementById('scriptVersion').value = script.version || '';\n            document.getElementById('scriptAuthor').value = script.author || '';\n            document.getElementById('scriptGameId').value = script.gameId || '';\n            document.getElementById('scriptStatus').value = script.status || 'draft';\n            \n            // 更新JSON编辑器\n            document.getElementById('jsonEditor').value = JSON.stringify(script, null, 2);\n        }\n        \n        // 创建新剧本\n        function createNewScript() {\n            const newScript = {\n                name: '新剧本',\n                description: '',\n                version: '1.0.0',\n                author: '',\n                gameId: 'default',\n                status: 'draft',\n                scenes: [],\n                tasks: [],\n                npcs: [],\n                items: [],\n                rules: [],\n                events: [],\n                settings: {}\n            };\n            \n            currentScript = newScript;\n            fillScriptForm(newScript);\n            \n            document.getElementById('saveBtn').disabled = false;\n            document.getElementById('deleteBtn').disabled = true;\n            \n            setStatus('创建新剧本');\n        }\n        \n        // 保存剧本\n        async function saveScript() {\n            if (!currentScript) return;\n            \n            try {\n                // 从表单收集数据\n                const scriptData = {\n                    ...currentScript,\n                    name: document.getElementById('scriptName').value,\n                    description: document.getElementById('scriptDescription').value,\n                    version: document.getElementById('scriptVersion').value,\n                    author: document.getElementById('scriptAuthor').value,\n                    gameId: document.getElementById('scriptGameId').value,\n                    status: document.getElementById('scriptStatus').value\n                };\n                \n                // 尝试解析JSON编辑器内容\n                try {\n                    const jsonData = JSON.parse(document.getElementById('jsonEditor').value);\n                    Object.assign(scriptData, jsonData);\n                } catch (e) {\n                    // JSON解析失败，使用表单数据\n                }\n                \n                const method = currentScript.id ? 'PUT' : 'POST';\n                const url = currentScript.id ? \\`/api/scripts/\\${currentScript.id}\\` : '/api/scripts';\n                \n                const response = await fetch(url, {\n                    method: method,\n                    headers: {\n                        'Content-Type': 'application/json'\n                    },\n                    body: JSON.stringify(scriptData)\n                });\n                \n                if (!response.ok) {\n                    throw new Error(\\`HTTP error! status: \\${response.status}\\`);\n                }\n                \n                const savedScript = await response.json();\n                currentScript = savedScript;\n                \n                // 重新加载剧本列表\n                await loadScripts();\n                \n                setStatus('剧本保存成功', 'success');\n                \n            } catch (error) {\n                console.error('Failed to save script:', error);\n                setStatus('保存失败: ' + error.message, 'error');\n            }\n        }\n        \n        // 删除剧本\n        async function deleteScript() {\n            if (!currentScript || !currentScript.id) return;\n            \n            if (!confirm('确定要删除这个剧本吗？此操作不可撤销。')) {\n                return;\n            }\n            \n            try {\n                const response = await fetch(\\`/api/scripts/\\${currentScript.id}\\`, {\n                    method: 'DELETE'\n                });\n                \n                if (!response.ok) {\n                    throw new Error(\\`HTTP error! status: \\${response.status}\\`);\n                }\n                \n                currentScript = null;\n                document.getElementById('saveBtn').disabled = true;\n                document.getElementById('deleteBtn').disabled = true;\n                \n                // 重新加载剧本列表\n                await loadScripts();\n                \n                setStatus('剧本删除成功', 'success');\n                \n            } catch (error) {\n                console.error('Failed to delete script:', error);\n                setStatus('删除失败: ' + error.message, 'error');\n            }\n        }\n        \n        // 验证剧本\n        function validateScript() {\n            try {\n                const jsonContent = document.getElementById('jsonEditor').value;\n                JSON.parse(jsonContent);\n                setStatus('剧本验证通过', 'success');\n            } catch (error) {\n                setStatus('剧本验证失败: ' + error.message, 'error');\n            }\n        }\n        \n        // 预览剧本\n        function previewScript() {\n            // 这里可以实现剧本预览功能\n            setStatus('预览功能待实现');\n        }\n        \n        // 切换标签页\n        function switchTab(tabName) {\n            // 隐藏所有标签内容\n            document.querySelectorAll('.tab-content').forEach(content => {\n                content.classList.remove('active');\n            });\n            \n            // 移除所有标签的活跃状态\n            document.querySelectorAll('.tab').forEach(tab => {\n                tab.classList.remove('active');\n            });\n            \n            // 显示选中的标签内容\n            document.getElementById(tabName + 'Tab').classList.add('active');\n            event.target.classList.add('active');\n        }\n        \n        // 添加场景\n        function addScene() {\n            setStatus('添加场景功能待实现');\n        }\n        \n        // 添加任务\n        function addTask() {\n            setStatus('添加任务功能待实现');\n        }\n        \n        // 添加规则\n        function addRule() {\n            setStatus('添加规则功能待实现');\n        }\n        \n        // 设置状态\n        function setStatus(message, type = 'info') {\n            const statusElement = document.getElementById('statusText');\n            statusElement.textContent = message;\n            \n            // 移除之前的状态类\n            statusElement.className = '';\n            \n            // 添加新的状态类\n            if (type !== 'info') {\n                statusElement.classList.add('status-' + type);\n            }\n        }\n        \n        // 获取状态文本\n        function getStatusText(status) {\n            const statusMap = {\n                'active': '活跃',\n                'draft': '草稿',\n                'inactive': '非活跃'\n            };\n            return statusMap[status] || status;\n        }\n    </script>\n</body>\n</html>\n`"