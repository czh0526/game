package script\n\nimport (\n\t\"encoding/json\"\n\t\"fmt\"\n\t\"sync\"\n\t\"time\"\n\n\t\"github.com/google/uuid\"\n\t\"github.com/hyperledger/aries-framework-go/spi/storage\"\n\n\t\"github.com/czh0526/game/server/internal/did\"\n\t\"github.com/czh0526/game/server/internal/vc\"\n)\n\n// ScriptEngine 剧本引擎\ntype ScriptEngine struct {\n\tstore       storage.Store\n\tdidService  *did.Service\n\tvcService   *vc.Service\n\tscripts     map[string]*GameScript\n\tinstances   map[string]*ScriptInstance\n\tmutex       sync.RWMutex\n}\n\n// GameScript 游戏剧本\ntype GameScript struct {\n\tID          string                 `json:\"id\"`\n\tName        string                 `json:\"name\"`\n\tDescription string                 `json:\"description\"`\n\tVersion     string                 `json:\"version\"`\n\tAuthor      string                 `json:\"author\"`\n\tGameID      string                 `json:\"gameId\"`\n\tStatus      string                 `json:\"status\"` // active, inactive, draft\n\tCreatedAt   time.Time              `json:\"createdAt\"`\n\tUpdatedAt   time.Time              `json:\"updatedAt\"`\n\t\n\t// 剧本内容\n\tScenes      []*Scene               `json:\"scenes\"`\n\tTasks       []*TaskTemplate        `json:\"tasks\"`\n\tNPCs        []*NPC                 `json:\"npcs\"`\n\tItems       []*Item                `json:\"items\"`\n\tRules       []*Rule                `json:\"rules\"`\n\tEvents      []*EventTemplate       `json:\"events\"`\n\tSettings    map[string]interface{} `json:\"settings\"`\n}\n\n// Scene 场景\ntype Scene struct {\n\tID          string                 `json:\"id\"`\n\tName        string                 `json:\"name\"`\n\tDescription string                 `json:\"description\"`\n\tType        string                 `json:\"type\"` // entrance, battle, puzzle, social\n\tPosition    Position               `json:\"position\"`\n\tSize        Size                   `json:\"size\"`\n\tBackground  string                 `json:\"background\"`\n\tMusic       string                 `json:\"music\"`\n\tObjects     []*SceneObject         `json:\"objects\"`\n\tTriggers    []*Trigger             `json:\"triggers\"`\n\tProperties  map[string]interface{} `json:\"properties\"`\n}\n\n// Position 位置\ntype Position struct {\n\tX float64 `json:\"x\"`\n\tY float64 `json:\"y\"`\n}\n\n// Size 尺寸\ntype Size struct {\n\tWidth  int `json:\"width\"`\n\tHeight int `json:\"height\"`\n}\n\n// SceneObject 场景对象\ntype SceneObject struct {\n\tID         string                 `json:\"id\"`\n\tType       string                 `json:\"type\"`\n\tName       string                 `json:\"name\"`\n\tPosition   Position               `json:\"position\"`\n\tSprite     string                 `json:\"sprite\"`\n\tInteractive bool                  `json:\"interactive\"`\n\tActions    []*Action              `json:\"actions\"`\n\tProperties map[string]interface{} `json:\"properties\"`\n}\n\n// TaskTemplate 任务模板\ntype TaskTemplate struct {\n\tID          string                 `json:\"id\"`\n\tName        string                 `json:\"name\"`\n\tDescription string                 `json:\"description\"`\n\tType        string                 `json:\"type\"` // main, side, daily, achievement\n\tCategory    string                 `json:\"category\"`\n\tDifficulty  int                    `json:\"difficulty\"`\n\tPrereqs     []string               `json:\"prerequisites\"`\n\tObjectives  []*ObjectiveTemplate   `json:\"objectives\"`\n\tRewards     []*RewardTemplate      `json:\"rewards\"`\n\tTimeLimit   *time.Duration         `json:\"timeLimit,omitempty\"`\n\tAutoAccept  bool                   `json:\"autoAccept\"`\n\tProperties  map[string]interface{} `json:\"properties\"`\n}\n\n// ObjectiveTemplate 目标模板\ntype ObjectiveTemplate struct {\n\tID          string                 `json:\"id\"`\n\tType        string                 `json:\"type\"` // kill, collect, interact, reach\n\tDescription string                 `json:\"description\"`\n\tTarget      string                 `json:\"target\"`\n\tQuantity    int                    `json:\"quantity\"`\n\tOptional    bool                   `json:\"optional\"`\n\tProperties  map[string]interface{} `json:\"properties\"`\n}\n\n// RewardTemplate 奖励模板\ntype RewardTemplate struct {\n\tType       string                 `json:\"type\"` // experience, item, credential, currency\n\tValue      interface{}            `json:\"value\"`\n\tQuantity   int                    `json:\"quantity\"`\n\tProperties map[string]interface{} `json:\"properties\"`\n}\n\n// NPC 非玩家角色\ntype NPC struct {\n\tID          string                 `json:\"id\"`\n\tName        string                 `json:\"name\"`\n\tDescription string                 `json:\"description\"`\n\tType        string                 `json:\"type\"` // merchant, quest_giver, guard, enemy\n\tSprite      string                 `json:\"sprite\"`\n\tPosition    Position               `json:\"position\"`\n\tDialogues   []*Dialogue            `json:\"dialogues\"`\n\tShop        *Shop                  `json:\"shop,omitempty\"`\n\tBehavior    *Behavior              `json:\"behavior\"`\n\tProperties  map[string]interface{} `json:\"properties\"`\n}\n\n// Dialogue 对话\ntype Dialogue struct {\n\tID        string                 `json:\"id\"`\n\tText      string                 `json:\"text\"`\n\tCondition *Condition             `json:\"condition,omitempty\"`\n\tOptions   []*DialogueOption      `json:\"options\"`\n\tActions   []*Action              `json:\"actions\"`\n\tProperties map[string]interface{} `json:\"properties\"`\n}\n\n// DialogueOption 对话选项\ntype DialogueOption struct {\n\tText      string     `json:\"text\"`\n\tNextID    string     `json:\"nextId\"`\n\tCondition *Condition `json:\"condition,omitempty\"`\n\tActions   []*Action  `json:\"actions\"`\n}\n\n// Shop 商店\ntype Shop struct {\n\tID       string      `json:\"id\"`\n\tName     string      `json:\"name\"`\n\tItems    []*ShopItem `json:\"items\"`\n\tCurrency string      `json:\"currency\"`\n}\n\n// ShopItem 商店物品\ntype ShopItem struct {\n\tItemID   string `json:\"itemId\"`\n\tPrice    int    `json:\"price\"`\n\tQuantity int    `json:\"quantity\"`\n\tStock    int    `json:\"stock\"`\n}\n\n// Item 物品\ntype Item struct {\n\tID          string                 `json:\"id\"`\n\tName        string                 `json:\"name\"`\n\tDescription string                 `json:\"description\"`\n\tType        string                 `json:\"type\"` // weapon, armor, consumable, key, quest\n\tRarity      string                 `json:\"rarity\"` // common, uncommon, rare, epic, legendary\n\tIcon        string                 `json:\"icon\"`\n\tStackable   bool                   `json:\"stackable\"`\n\tMaxStack    int                    `json:\"maxStack\"`\n\tValue       int                    `json:\"value\"`\n\tEffects     []*Effect              `json:\"effects\"`\n\tProperties  map[string]interface{} `json:\"properties\"`\n}\n\n// Effect 效果\ntype Effect struct {\n\tType       string                 `json:\"type\"`\n\tValue      interface{}            `json:\"value\"`\n\tDuration   *time.Duration         `json:\"duration,omitempty\"`\n\tProperties map[string]interface{} `json:\"properties\"`\n}\n\n// Rule 规则\ntype Rule struct {\n\tID          string                 `json:\"id\"`\n\tName        string                 `json:\"name\"`\n\tDescription string                 `json:\"description\"`\n\tType        string                 `json:\"type\"` // trigger, condition, action\n\tCondition   *Condition             `json:\"condition\"`\n\tActions     []*Action              `json:\"actions\"`\n\tPriority    int                    `json:\"priority\"`\n\tEnabled     bool                   `json:\"enabled\"`\n\tProperties  map[string]interface{} `json:\"properties\"`\n}\n\n// Condition 条件\ntype Condition struct {\n\tType       string                 `json:\"type\"` // player_level, has_item, completed_task, time\n\tOperator   string                 `json:\"operator\"` // eq, ne, gt, lt, gte, lte, in, contains\n\tValue      interface{}            `json:\"value\"`\n\tProperties map[string]interface{} `json:\"properties\"`\n}\n\n// Action 动作\ntype Action struct {\n\tType       string                 `json:\"type\"` // give_item, start_task, teleport, spawn_npc\n\tTarget     string                 `json:\"target\"`\n\tValue      interface{}            `json:\"value\"`\n\tProperties map[string]interface{} `json:\"properties\"`\n}\n\n// Trigger 触发器\ntype Trigger struct {\n\tID        string     `json:\"id\"`\n\tType      string     `json:\"type\"` // enter, exit, interact, timer\n\tCondition *Condition `json:\"condition,omitempty\"`\n\tActions   []*Action  `json:\"actions\"`\n\tOnce      bool       `json:\"once\"`\n\tEnabled   bool       `json:\"enabled\"`\n}\n\n// Behavior 行为\ntype Behavior struct {\n\tType       string                 `json:\"type\"` // static, patrol, aggressive, friendly\n\tPath       []Position             `json:\"path,omitempty\"`\n\tSpeed      float64                `json:\"speed\"`\n\tRange      float64                `json:\"range\"`\n\tProperties map[string]interface{} `json:\"properties\"`\n}\n\n// EventTemplate 事件模板\ntype EventTemplate struct {\n\tID          string                 `json:\"id\"`\n\tName        string                 `json:\"name\"`\n\tDescription string                 `json:\"description\"`\n\tType        string                 `json:\"type\"` // timed, random, triggered\n\tTrigger     *Trigger               `json:\"trigger\"`\n\tFrequency   *time.Duration         `json:\"frequency,omitempty\"`\n\tChance      float64                `json:\"chance\"`\n\tActions     []*Action              `json:\"actions\"`\n\tProperties  map[string]interface{} `json:\"properties\"`\n}\n\n// ScriptInstance 剧本实例\ntype ScriptInstance struct {\n\tID         string                 `json:\"id\"`\n\tScriptID   string                 `json:\"scriptId\"`\n\tRoomID     string                 `json:\"roomId\"`\n\tStatus     string                 `json:\"status\"` // running, paused, completed, failed\n\tStartTime  time.Time              `json:\"startTime\"`\n\tEndTime    *time.Time             `json:\"endTime,omitempty\"`\n\tPlayers    []string               `json:\"players\"`\n\tState      map[string]interface{} `json:\"state\"`\n\tVariables  map[string]interface{} `json:\"variables\"`\n\tCreatedAt  time.Time              `json:\"createdAt\"`\n\tUpdatedAt  time.Time              `json:\"updatedAt\"`\n}\n\n// NewScriptEngine 创建新的剧本引擎\nfunc NewScriptEngine(storageProvider storage.Provider, didService *did.Service, vcService *vc.Service) (*ScriptEngine, error) {\n\tstore, err := storageProvider.OpenStore(\"script_engine\")\n\tif err != nil {\n\t\treturn nil, fmt.Errorf(\"open script store: %w\", err)\n\t}\n\n\tengine := &ScriptEngine{\n\t\tstore:      store,\n\t\tdidService: didService,\n\t\tvcService:  vcService,\n\t\tscripts:   make(map[string]*GameScript),\n\t\tinstances: make(map[string]*ScriptInstance),\n\t}\n\n\t// 从存储中加载剧本\n\tif err := engine.loadScripts(); err != nil {\n\t\treturn nil, fmt.Errorf(\"load scripts: %w\", err)\n\t}\n\n\t// 创建默认剧本\n\tif len(engine.scripts) == 0 {\n\t\tif err := engine.createDefaultScript(); err != nil {\n\t\t\treturn nil, fmt.Errorf(\"create default script: %w\", err)\n\t\t}\n\t}\n\n\treturn engine, nil\n}\n\n// CreateScript 创建新剧本\nfunc (e *ScriptEngine) CreateScript(script *GameScript) error {\n\te.mutex.Lock()\n\tdefer e.mutex.Unlock()\n\n\tif script.ID == \"\" {\n\t\tscript.ID = uuid.New().String()\n\t}\n\n\tscript.CreatedAt = time.Now()\n\tscript.UpdatedAt = time.Now()\n\n\te.scripts[script.ID] = script\n\n\t// 保存到存储\n\treturn e.saveScript(script)\n}\n\n// UpdateScript 更新剧本\nfunc (e *ScriptEngine) UpdateScript(script *GameScript) error {\n\te.mutex.Lock()\n\tdefer e.mutex.Unlock()\n\n\tif _, exists := e.scripts[script.ID]; !exists {\n\t\treturn fmt.Errorf(\"script not found: %s\", script.ID)\n\t}\n\n\tscript.UpdatedAt = time.Now()\n\te.scripts[script.ID] = script\n\n\treturn e.saveScript(script)\n}\n\n// DeleteScript 删除剧本\nfunc (e *ScriptEngine) DeleteScript(scriptID string) error {\n\te.mutex.Lock()\n\tdefer e.mutex.Unlock()\n\n\tdelete(e.scripts, scriptID)\n\n\t// 从存储中删除\n\tkey := fmt.Sprintf(\"script:%s\", scriptID)\n\treturn e.store.Delete(key)\n}\n\n// GetScript 获取剧本\nfunc (e *ScriptEngine) GetScript(scriptID string) (*GameScript, error) {\n\te.mutex.RLock()\n\tdefer e.mutex.RUnlock()\n\n\tscript, exists := e.scripts[scriptID]\n\tif !exists {\n\t\treturn nil, fmt.Errorf(\"script not found: %s\", scriptID)\n\t}\n\n\treturn script, nil\n}\n\n// ListScripts 列出所有剧本\nfunc (e *ScriptEngine) ListScripts() []*GameScript {\n\te.mutex.RLock()\n\tdefer e.mutex.RUnlock()\n\n\tscripts := make([]*GameScript, 0, len(e.scripts))\n\tfor _, script := range e.scripts {\n\t\tscripts = append(scripts, script)\n\t}\n\n\treturn scripts\n}\n\n// StartScript 启动剧本实例\nfunc (e *ScriptEngine) StartScript(scriptID, roomID string, players []string) (*ScriptInstance, error) {\n\te.mutex.Lock()\n\tdefer e.mutex.Unlock()\n\n\tscript, exists := e.scripts[scriptID]\n\tif !exists {\n\t\treturn nil, fmt.Errorf(\"script not found: %s\", scriptID)\n\t}\n\n\tif script.Status != \"active\" {\n\t\treturn nil, fmt.Errorf(\"script is not active: %s\", scriptID)\n\t}\n\n\t// 创建剧本实例\n\tinstance := &ScriptInstance{\n\t\tID:        uuid.New().String(),\n\t\tScriptID:  scriptID,\n\t\tRoomID:    roomID,\n\t\tStatus:    \"running\",\n\t\tStartTime: time.Now(),\n\t\tPlayers:   players,\n\t\tState:     make(map[string]interface{}),\n\t\tVariables: make(map[string]interface{}),\n\t\tCreatedAt: time.Now(),\n\t\tUpdatedAt: time.Now(),\n\t}\n\n\t// 初始化剧本状态\n\tif err := e.initializeScriptInstance(instance, script); err != nil {\n\t\treturn nil, fmt.Errorf(\"initialize script instance: %w\", err)\n\t}\n\n\te.instances[instance.ID] = instance\n\n\t// 保存实例\n\tif err := e.saveInstance(instance); err != nil {\n\t\treturn nil, fmt.Errorf(\"save instance: %w\", err)\n\t}\n\n\treturn instance, nil\n}\n\n// StopScript 停止剧本实例\nfunc (e *ScriptEngine) StopScript(instanceID string) error {\n\te.mutex.Lock()\n\tdefer e.mutex.Unlock()\n\n\tinstance, exists := e.instances[instanceID]\n\tif !exists {\n\t\treturn fmt.Errorf(\"instance not found: %s\", instanceID)\n\t}\n\n\tinstance.Status = \"completed\"\n\tnow := time.Now()\n\tinstance.EndTime = &now\n\tinstance.UpdatedAt = now\n\n\treturn e.saveInstance(instance)\n}\n\n// ProcessEvent 处理游戏事件\nfunc (e *ScriptEngine) ProcessEvent(instanceID string, eventType string, data map[string]interface{}) error {\n\te.mutex.RLock()\n\tinstance, exists := e.instances[instanceID]\n\te.mutex.RUnlock()\n\n\tif !exists || instance.Status != \"running\" {\n\t\treturn nil // 忽略无效实例的事件\n\t}\n\n\tscript, err := e.GetScript(instance.ScriptID)\n\tif err != nil {\n\t\treturn fmt.Errorf(\"get script: %w\", err)\n\t}\n\n\t// 处理规则\n\tfor _, rule := range script.Rules {\n\t\tif !rule.Enabled {\n\t\t\tcontinue\n\t\t}\n\n\t\tif e.evaluateCondition(rule.Condition, instance, data) {\n\t\t\tif err := e.executeActions(rule.Actions, instance, data); err != nil {\n\t\t\t\treturn fmt.Errorf(\"execute rule actions: %w\", err)\n\t\t\t}\n\t\t}\n\t}\n\n\treturn nil\n}\n\n// evaluateCondition 评估条件\nfunc (e *ScriptEngine) evaluateCondition(condition *Condition, instance *ScriptInstance, data map[string]interface{}) bool {\n\tif condition == nil {\n\t\treturn true\n\t}\n\n\t// 根据条件类型进行评估\n\tswitch condition.Type {\n\tcase \"player_level\":\n\t\t// 检查玩家等级\n\t\treturn e.checkPlayerLevel(condition, instance, data)\n\tcase \"has_item\":\n\t\t// 检查是否拥有物品\n\t\treturn e.checkHasItem(condition, instance, data)\n\tcase \"completed_task\":\n\t\t// 检查是否完成任务\n\t\treturn e.checkCompletedTask(condition, instance, data)\n\tcase \"event_type\":\n\t\t// 检查事件类型\n\t\teventType, ok := data[\"type\"].(string)\n\t\tif !ok {\n\t\t\treturn false\n\t\t}\n\t\treturn e.compareValues(eventType, condition.Operator, condition.Value)\n\tdefault:\n\t\treturn false\n\t}\n}\n\n// executeActions 执行动作\nfunc (e *ScriptEngine) executeActions(actions []*Action, instance *ScriptInstance, data map[string]interface{}) error {\n\tfor _, action := range actions {\n\t\tif err := e.executeAction(action, instance, data); err != nil {\n\t\t\treturn fmt.Errorf(\"execute action %s: %w\", action.Type, err)\n\t\t}\n\t}\n\treturn nil\n}\n\n// executeAction 执行单个动作\nfunc (e *ScriptEngine) executeAction(action *Action, instance *ScriptInstance, data map[string]interface{}) error {\n\tswitch action.Type {\n\tcase \"give_item\":\n\t\treturn e.actionGiveItem(action, instance, data)\n\tcase \"start_task\":\n\t\treturn e.actionStartTask(action, instance, data)\n\tcase \"issue_credential\":\n\t\treturn e.actionIssueCredential(action, instance, data)\n\tcase \"set_variable\":\n\t\treturn e.actionSetVariable(action, instance, data)\n\tcase \"send_message\":\n\t\treturn e.actionSendMessage(action, instance, data)\n\tdefault:\n\t\treturn fmt.Errorf(\"unknown action type: %s\", action.Type)\n\t}\n}\n\n// 动作实现\nfunc (e *ScriptEngine) actionGiveItem(action *Action, instance *ScriptInstance, data map[string]interface{}) error {\n\t// 给予物品的逻辑\n\titemID, ok := action.Value.(string)\n\tif !ok {\n\t\treturn fmt.Errorf(\"invalid item ID\")\n\t}\n\n\t// 这里可以实现物品给予逻辑\n\tfmt.Printf(\"Giving item %s to players in instance %s\\n\", itemID, instance.ID)\n\treturn nil\n}\n\nfunc (e *ScriptEngine) actionStartTask(action *Action, instance *ScriptInstance, data map[string]interface{}) error {\n\t// 开始任务的逻辑\n\ttaskID, ok := action.Value.(string)\n\tif !ok {\n\t\treturn fmt.Errorf(\"invalid task ID\")\n\t}\n\n\tfmt.Printf(\"Starting task %s for players in instance %s\\n\", taskID, instance.ID)\n\treturn nil\n}\n\nfunc (e *ScriptEngine) actionIssueCredential(action *Action, instance *ScriptInstance, data map[string]interface{}) error {\n\t// 颁发凭证的逻辑\n\tcredData, ok := action.Value.(map[string]interface{})\n\tif !ok {\n\t\treturn fmt.Errorf(\"invalid credential data\")\n\t}\n\n\t// 为每个玩家颁发凭证\n\tfor _, playerID := range instance.Players {\n\t\t// 这里需要获取玩家的DID\n\t\t// 然后使用VC服务颁发凭证\n\t\tfmt.Printf(\"Issuing credential to player %s in instance %s\\n\", playerID, instance.ID)\n\t}\n\n\treturn nil\n}\n\nfunc (e *ScriptEngine) actionSetVariable(action *Action, instance *ScriptInstance, data map[string]interface{}) error {\n\t// 设置变量\n\tinstance.Variables[action.Target] = action.Value\n\tinstance.UpdatedAt = time.Now()\n\treturn e.saveInstance(instance)\n}\n\nfunc (e *ScriptEngine) actionSendMessage(action *Action, instance *ScriptInstance, data map[string]interface{}) error {\n\t// 发送消息\n\tmessage, ok := action.Value.(string)\n\tif !ok {\n\t\treturn fmt.Errorf(\"invalid message\")\n\t}\n\n\tfmt.Printf(\"Sending message '%s' to players in instance %s\\n\", message, instance.ID)\n\treturn nil\n}\n\n// 条件检查实现\nfunc (e *ScriptEngine) checkPlayerLevel(condition *Condition, instance *ScriptInstance, data map[string]interface{}) bool {\n\t// 检查玩家等级的逻辑\n\treturn true // 简化实现\n}\n\nfunc (e *ScriptEngine) checkHasItem(condition *Condition, instance *ScriptInstance, data map[string]interface{}) bool {\n\t// 检查是否拥有物品的逻辑\n\treturn true // 简化实现\n}\n\nfunc (e *ScriptEngine) checkCompletedTask(condition *Condition, instance *ScriptInstance, data map[string]interface{}) bool {\n\t// 检查是否完成任务的逻辑\n\treturn true // 简化实现\n}\n\n// compareValues 比较值\nfunc (e *ScriptEngine) compareValues(actual interface{}, operator string, expected interface{}) bool {\n\tswitch operator {\n\tcase \"eq\":\n\t\treturn actual == expected\n\tcase \"ne\":\n\t\treturn actual != expected\n\t// 可以添加更多比较操作符\n\tdefault:\n\t\treturn false\n\t}\n}\n\n// 存储相关方法\nfunc (e *ScriptEngine) saveScript(script *GameScript) error {\n\tdata, err := json.Marshal(script)\n\tif err != nil {\n\t\treturn fmt.Errorf(\"marshal script: %w\", err)\n\t}\n\n\tkey := fmt.Sprintf(\"script:%s\", script.ID)\n\treturn e.store.Put(key, data)\n}\n\nfunc (e *ScriptEngine) saveInstance(instance *ScriptInstance) error {\n\tdata, err := json.Marshal(instance)\n\tif err != nil {\n\t\treturn fmt.Errorf(\"marshal instance: %w\", err)\n\t}\n\n\tkey := fmt.Sprintf(\"instance:%s\", instance.ID)\n\treturn e.store.Put(key, data)\n}\n\nfunc (e *ScriptEngine) loadScripts() error {\n\t// 从存储中加载所有剧本\n\t// 这里需要实现存储遍历逻辑\n\treturn nil\n}\n\nfunc (e *ScriptEngine) initializeScriptInstance(instance *ScriptInstance, script *GameScript) error {\n\t// 初始化剧本实例状态\n\tinstance.State[\"current_scene\"] = \"\"\n\tinstance.State[\"active_tasks\"] = []string{}\n\tinstance.State[\"completed_tasks\"] = []string{}\n\n\t// 设置初始变量\n\tfor key, value := range script.Settings {\n\t\tinstance.Variables[key] = value\n\t}\n\n\treturn nil\n}\n\nfunc (e *ScriptEngine) createDefaultScript() error {\n\t// 创建默认剧本\n\tdefaultScript := &GameScript{\n\t\tID:          \"default\",\n\t\tName:        \"Default Adventure\",\n\t\tDescription: \"A simple adventure script for new players\",\n\t\tVersion:     \"1.0.0\",\n\t\tAuthor:      \"System\",\n\t\tGameID:      \"default\",\n\t\tStatus:      \"active\",\n\t\tScenes: []*Scene{\n\t\t\t{\n\t\t\t\tID:          \"entrance\",\n\t\t\t\tName:        \"Village Entrance\",\n\t\t\t\tDescription: \"The entrance to a peaceful village\",\n\t\t\t\tType:        \"entrance\",\n\t\t\t\tPosition:    Position{X: 0, Y: 0},\n\t\t\t\tSize:        Size{Width: 800, Height: 600},\n\t\t\t\tObjects: []*SceneObject{\n\t\t\t\t\t{\n\t\t\t\t\t\tID:          \"welcome_sign\",\n\t\t\t\t\t\tType:        \"sign\",\n\t\t\t\t\t\tName:        \"Welcome Sign\",\n\t\t\t\t\t\tPosition:    Position{X: 100, Y: 100},\n\t\t\t\t\t\tInteractive: true,\n\t\t\t\t\t\tActions: []*Action{\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tType:   \"send_message\",\n\t\t\t\t\t\t\t\tValue:  \"Welcome to the village!\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tTasks: []*TaskTemplate{\n\t\t\t{\n\t\t\t\tID:          \"first_steps\",\n\t\t\t\tName:        \"First Steps\",\n\t\t\t\tDescription: \"Learn the basics of the game\",\n\t\t\t\tType:        \"main\",\n\t\t\t\tDifficulty:  1,\n\t\t\t\tAutoAccept:  true,\n\t\t\t\tObjectives: []*ObjectiveTemplate{\n\t\t\t\t\t{\n\t\t\t\t\t\tID:          \"move_around\",\n\t\t\t\t\t\tType:        \"reach\",\n\t\t\t\t\t\tDescription: \"Move around using WASD keys\",\n\t\t\t\t\t\tTarget:      \"any_position\",\n\t\t\t\t\t\tQuantity:    1,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tRewards: []*RewardTemplate{\n\t\t\t\t\t{\n\t\t\t\t\t\tType:     \"credential\",\n\t\t\t\t\t\tValue:    \"FirstStepsCredential\",\n\t\t\t\t\t\tQuantity: 1,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tRules: []*Rule{\n\t\t\t{\n\t\t\t\tID:          \"welcome_rule\",\n\t\t\t\tName:        \"Welcome New Players\",\n\t\t\t\tDescription: \"Welcome message for new players\",\n\t\t\t\tType:        \"trigger\",\n\t\t\t\tCondition: &Condition{\n\t\t\t\t\tType:     \"event_type\",\n\t\t\t\t\tOperator: \"eq\",\n\t\t\t\t\tValue:    \"player_joined\",\n\t\t\t\t},\n\t\t\t\tActions: []*Action{\n\t\t\t\t\t{\n\t\t\t\t\t\tType:  \"send_message\",\n\t\t\t\t\t\tValue: \"Welcome to the adventure!\",\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tType:   \"start_task\",\n\t\t\t\t\t\tValue:  \"first_steps\",\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tEnabled: true,\n\t\t\t},\n\t\t},\n\t\tSettings: map[string]interface{}{\n\t\t\t\"max_players\":    10,\n\t\t\t\"difficulty\":     \"easy\",\n\t\t\t\"auto_save\":      true,\n\t\t\t\"respawn_time\":   30,\n\t\t},\n\t}\n\n\treturn e.CreateScript(defaultScript)\n}"