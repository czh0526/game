# UI 设计需求文档

## 概述

本文档描述了 Aries Game System 的 UI 面板设计需求,包括面板布局、定位方式、交互功能和持久化存储。

## 整体布局

### 容器结构

- **#gameContainer**: 主容器,使用 flexbox 布局
  - 位置: 全屏 (100vw x 100vh)
  - 布局: `display: flex; justify-content: space-between; align-items: flex-start;`
  - 内边距: 10px
  - 包含: 游戏画布、左侧面板容器、右侧面板容器

- **#gameCanvas**: 游戏画布
  - 位置: 绝对定位,覆盖整个容器
  - 层级: z-index: 0 (最低)
  - 背景: 黑色 (#000)
  - 边框: 2px solid #333

- **#ui**: 左侧面板容器
  - 布局: `display: flex; flex-direction: column; gap: 10px;`
  - 层级: z-index: 100
  - 最大高度: calc(100vh - 20px)
  - 溢出: 垂直滚动
  - 包含: 玩家身份、钱包、游戏控制面板

- **#rightPanels**: 右侧面板容器
  - 布局: `display: flex; flex-direction: column; gap: 10px;`
  - 层级: z-index: 100
  - 最大高度: calc(100vh - 20px)
  - 溢出: 垂直滚动
  - 包含: 在线玩家、聊天记录面板

## 面板设计

### 通用样式

所有面板共享以下样式:

```css
background: rgba(0, 0, 0, 0.8)
border: 1px solid #555
border-radius: 5px
padding: 10px
min-width: 200px
position: relative  /* 流式布局,非绝对定位 */
user-select: none
display: flex
flex-direction: column
flex-shrink: 0  /* 防止被压缩 */
transition: all 0.3s ease  /* 平滑过渡动画 */
```

### 面板标题样式

每个面板的标题 (h3) 包含以下样式:
- 使用 flexbox 布局,标题文字和折叠按钮左右排列
- 颜色: #00ff00 (绿色)
- 光标: pointer (可点击)
- 间距: 标题和折叠按钮之间有 10px 间距

### 面板列表

#### 1. 玩家身份面板 (#identityPanel)

- **位置**: 左侧容器,第一个
- **宽度**: 250px
- **高度**: auto (自适应内容)
- **内容**:
  - 标题: "玩家身份"
  - 折叠按钮 (▼)
  - 内容容器包含:
    - DID 显示
    - 连接状态显示
    - 创建身份按钮
    - 连接游戏按钮
- **调整大小**: 支持调整宽度和高度
- **折叠功能**: 点击折叠按钮可折叠/展开面板内容

#### 2. 钱包面板 (#walletPanel)

- **位置**: 左侧容器,第二个
- **宽度**: 250px
- **高度**: auto (自适应内容)
- **内容**:
  - 标题: "钱包"
  - 折叠按钮 (▼)
  - 内容容器包含:
    - 凭证数量显示
    - 查看钱包按钮
- **调整大小**: 支持调整宽度和高度
- **折叠功能**: 点击折叠按钮可折叠/展开面板内容

#### 3. 游戏控制面板 (#controlPanel)

- **位置**: 左侧容器,第三个
- **宽度**: 250px
- **高度**: auto (自适应内容)
- **内容**:
  - 标题: "游戏控制"
  - 折叠按钮 (▼)
  - 内容容器包含:
    - 玩家位置显示 (X, Y 坐标)
    - 操作提示: "使用 WASD 键移动"
    - 剧本编辑器按钮 (打开新窗口)
- **调整大小**: 支持调整宽度和高度
- **折叠功能**: 点击折叠按钮可折叠/展开面板内容

#### 4. 在线玩家面板 (#playerListPanel)

- **位置**: 右侧容器,第一个
- **宽度**: 280px
- **高度**: 400px (默认)
- **内容**:
  - 标题: "在线玩家 (N)" - 显示在线人数
  - 折叠按钮 (▼)
  - 内容容器包含:
    - 标签页切换:
      - 好友标签
      - 大厅标签
    - 好友请求容器
    - 玩家列表 (可滚动)
- **调整大小**: 支持调整宽度和高度
- **内容滚动**: `#playerList` 区域可垂直滚动
- **折叠功能**: 点击折叠按钮可折叠/展开面板内容

#### 5. 聊天记录面板 (#chatPanel)

- **位置**: 右侧容器,第二个
- **宽度**: 280px
- **高度**: 300px (默认)
- **内容**:
  - 标题: "聊天记录"
  - 折叠按钮 (▼)
  - 内容容器包含:
    - 聊天消息区域 (可滚动)
    - 消息输入框
- **调整大小**: 支持调整宽度和高度
- **内容滚动**: `#chatMessages` 区域可垂直滚动
- **折叠功能**: 点击折叠按钮可折叠/展开面板内容

## 交互功能

### 调整大小

- **调整手柄**: 每个面板右下角有 10x10px 的调整手柄
- **手柄样式**:
  - 默认: background: #888
  - 悬停: background: #aaa
  - 光标: nwse-resize
- **调整状态**: 面板添加 `.resizing` 类,透明度 0.9

### 尺寸限制

- **最小宽度**: 200px
- **最小高度**: 150px

### 持久化存储

所有面板的尺寸设置会持久化存储在浏览器的 localStorage 中:

**存储格式**:
```javascript
{
  identity: { width: 250, height: 'auto' },
  wallet: { width: 250, height: 'auto' },
  control: { width: 250, height: 'auto' },
  playerList: { width: 280, height: 400 },
  chat: { width: 280, height: 300 }
}
```

**存储键名**: `gamePanelSettings`

**自动保存时机**:
- 调整面板大小后立即保存
- 页面卸载前保存所有设置

**自动恢复**:
- 页面加载时从 localStorage 读取保存的设置
- 如果没有保存的设置,使用默认设置

**数据清理**:
- 检测到旧格式数据时自动清理
- 提供 `resetSettings()` 方法重置为默认设置

## 响应式设计

### 流式布局特点

- 使用 flexbox 布局,自动适应不同屏幕尺寸
- 左侧面板靠左,右侧面板靠右
- 面板之间保持固定间距 (10px)
- 面板不会重叠或超出屏幕边界
- 如果屏幕高度不足,容器可以垂直滚动

### 跨分辨率一致性

- 在任何屏幕尺寸下布局都保持一致
- 面板始终保持左右两侧排列
- 间距和比例保持不变
- 无需手动拖动调整位置

## 内容区域滚动

### 可滚动区域

面板内容超出时自动显示滚动条:

- **#playerList**: 玩家列表区域
  - `min-height: 0`
  - `flex: 1`
  - `overflow-y: auto`

- **#chatMessages**: 聊天消息区域
  - `min-height: 0`
  - `flex: 1`
  - `overflow-y: auto`

### 滚动行为

- 内容区域自动填充面板可用空间
- 超出部分显示滚动条
- 面板调整大小时,内容区域自动适应

## 视觉样式

### 颜色方案

- **背景**: rgba(0, 0, 0, 0.8) - 半透明黑色
- **边框**: #555 - 深灰色
- **标题**: #00ff00 - 绿色
- **文本**: #ffffff - 白色
- **按钮背景**: #333 - 深灰色
- **按钮悬停**: #555 - 中灰色
- **输入框背景**: #222 - 深灰色
- **输入框边框**: #555 - 深灰色

### 字体

- **字体族**: 'Courier New', monospace
- **面板标题**: 正常
- **聊天消息**: 13px
- **玩家列表**: 12px

### 边框和圆角

- **面板边框**: 1px solid #555
- **面板圆角**: 5px
- **按钮圆角**: 3px
- **输入框圆角**: 3px

## 特殊元素

### 玩家标签页

- **布局**: 水平 flex 布局
- **底部边框**: 2px solid #555
- **标签样式**:
  - 默认: color: #888
  - 悬停: color: #fff, background: rgba(255, 255, 255, 0.05)
  - 激活: color: #00ff00, border-bottom: 2px solid #00ff00

### 聊天消息

- **系统消息**: color: #ffcc00, font-style: italic
- **聊天消息**: color: #ffffff
- **成功消息**: color: #4CAF50
- **错误消息**: color: #ff4444
- **凭证消息**: color: #9C27B0, font-weight: bold
- **玩家昵称**: color: #2196F3, font-weight: bold
- **时间戳**: color: #888, font-size: 11px

### 玩家状态指示器

- **在线**: background: #00ff00, box-shadow: 0 0 5px #00ff00
- **离线**: background: #ff4444
- **空闲**: background: #ff9800

## 模态对话框

### 钱包模态框 (#walletModal)

- **位置**: 固定定位,覆盖整个屏幕
- **背景**: rgba(0, 0, 0, 0.8)
- **层级**: z-index: 1000
- **对话框位置**: 居中 (top: 50%, left: 50%, transform: translate(-50%, -50%))
- **最小宽度**: 400px
- **背景**: #222
- **边框**: 1px solid #555
- **圆角**: 10px
- **内边距**: 20px
- **关闭按钮**: 点击关闭模态框

## 技术实现

### 文件结构

```
client/
├── index.html              # 主 HTML 文件,包含所有面板和样式
├── src/
│   ├── panelManager.js    # 面板管理器,处理调整大小和持久化
│   ├── ui/                # UI 相关逻辑
│   └── ...
└── requirements/
    └── UI.md              # 本需求文档
```

### 核心类: PanelManager

**功能**:
- 管理所有面板的尺寸设置
- 实现面板调整大小功能
- 持久化存储面板设置
- 自动清理旧格式数据

**主要方法**:
- `init()`: 初始化面板管理器
- `setupPanels()`: 设置所有面板
- `applySettings(panelId, panel)`: 应用面板设置
- `makeResizable(panel)`: 实现调整大小功能
- `loadSettings()`: 从 localStorage 加载设置
- `saveSettings()`: 保存设置到 localStorage
- `getCurrentSettings()`: 获取当前面板设置
- `updateSetting(panelId, updates)`: 更新单个面板设置
- `resetSettings()`: 重置为默认设置

## 开发规范

### 命名约定

- **面板 ID**: 小写驼峰命名 (如: identityPanel, walletPanel)
- **CSS 类名**: 小写 + 连字符 (如: panel, resize-handle)
- **数据属性**: 小写 (如: data-panel="identity")

### 代码组织

- CSS 样式定义在 index.html 的 `<style>` 标签中
- JavaScript 逻辑按功能模块分离
- 面板相关代码集中在 panelManager.js

### 浏览器兼容性

- 使用现代浏览器特性 (ES6+, CSS3 Flexbox)
- 支持 localStorage API
- 支持 CSS 变量和 flexbox

## 未来扩展

### 可能的增强功能

1. **面板折叠**: 允许用户折叠面板以节省空间
2. **面板主题**: 支持不同的颜色主题
3. **面板排序**: 允许用户调整面板顺序
4. **自定义布局**: 允许用户自定义面板布局方案
5. **快捷键**: 支持键盘快捷键操作面板
6. **动画效果**: 添加平滑的过渡动画

### 性能优化

- 使用虚拟滚动优化长列表性能
- 懒加载面板内容
- 减少不必要的 DOM 操作
- 优化 localStorage 读写频率

## 附录

### 默认面板尺寸

| 面板 | 宽度 | 高度 |
|------|------|------|
| 玩家身份 | 250px | auto |
| 钱包 | 250px | auto |
| 游戏控制 | 250px | auto |
| 在线玩家 | 280px | 400px |
| 聊天记录 | 280px | 300px |

### 布局示意

```
+----------------------------------------------------+
|  左侧面板容器              游戏画布     右侧面板容器|
|                                                    |
|  +--------------+                        +-------+  |
|  | 玩家身份     |                        |在线玩家|  |
|  +--------------+                        +-------+  |
|                                                    |
|  +--------------+                        +-------+  |
|  | 钱包         |                        |聊天记录|  |
|  +--------------+                        +-------+  |
|                                                    |
|  +--------------+                                  |
|  | 游戏控制     |                                  |
|  +--------------+                                  |
|                                                    |
+----------------------------------------------------+
```

### 版本历史

- **v1.0** - 初始版本,实现基本的流式布局和调整大小功能
  - 移除拖动功能,使用固定位置的流式布局
  - 实现面板尺寸持久化存储
  - 支持所有面板的高度调整
  - 使用 flexbox 实现响应式布局
